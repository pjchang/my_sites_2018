<!doctype html>
<html lang=''>

<head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" >
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
    <script src="http://code.jquery.com/jquery-latest.min.js" type="text/javascript"></script>
    <script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>
    <title>Skillscape</title>
    <style>
    body {
        font-family: 'Raleway', sans-serif;        
    }
    
    .node {
        stroke: #003366;
        stroke-width: 1px;
    }
    
    .link {
        fill: none;
        stroke: #6fafaf;
        stroke-width: 1px;
        opacity: 0.2;
    }

    /* for search box> */
    /* min Jquery CSS elements for autocomplete */

    .ui-autocomplete {
        position: absolute;
        cursor: default;
    }


    .ui-menu {
        list-style: none;
        padding: 2px;
        margin: 0;
        display: block;
        float: left;
        background-color: #f9f9f9;
        border: 1px solid #efefef;
        border-radius: 3px 3px 3px 3px;
    }

    .ui-menu .ui-menu {
        margin-top: -3px;
    }

    .ui-menu .ui-menu-item {
        margin: 0;
        padding: 0;
        zoom: 1;
        float: left;
        clear: left;
        width: 100%;
        font-family: arial;
    }

    .ui-menu .ui-menu-item a {
        text-decoration: none;
        display: block;
        padding: .1em .3em;
        line-height: 1.5;
        zoom: 1;
    }

    .ui-menu .ui-menu-item a.ui-state-hover,
    .ui-menu .ui-menu-item a.ui-state-active {
        font-weight: bold;
    }

    .ui-helper-hidden-accessible {
        display:none;
    }

    .ui-widget-content {
        width: 190px;
        font-size: 12px;
    }


    
    .d3-tip {
        line-height: 1;
        padding: 8px;
        background: white;
        color: black;
        font-size: 12px;
        font-family: sans-serif;
        border-radius: 2px;
        border: solid 1px #aaa;
    }
        
    /* Creates a small triangle extender for the tooltip */
    .d3-tip:after {
        box-sizing: border-box;
        display: inline;
        font-size: 10px;
        width: 100%;
        line-height: 1;
        color: rgba(0, 0, 0, 0.8);
        content: "\25BC";
        position: absolute;
        text-align: center;

    }

    /* Style northward tooltips differently */
    .d3-tip.n:after {
        margin: -1px 0 0 0;
        top: 100%;
        left: 0;
    }    
    

    #svglengend {
        display: none;
    }
    /* !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! */
    
    .legendtitle,
    .legendtext {
        font-size: 14px
    }
    /* !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! */
    
    @media only screen and (max-width: 767px) {
        .node {
            stroke-width: 0.5px;
        }
        .legendtitle {
            font-size: 10px
        }
        .legendtext {
            font-size: 7px
        }
    }
    
    @media only screen and (max-width: 992px) {
        #svglengend {
            display: block;
        }
    }
    
    @media only screen and (min-width: 768px) and (max-width: 992px) {}
    /* !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! */
    </style>
    <link href='https://fonts.googleapis.com/css?family=Raleway' rel='stylesheet' type='text/css'>
    <script type="text/javascript" src="json files/job_categories.js"></script>
    <script type="text/javascript" src="bootstrap/js/bootstrap.min.js"></script>
</head>

<body>
    <div>
    <nav class="navbar navbar-inverse">
    <div class="container-fluid">
        <div class="navbar-header" id='websiteTitle'>
          <div class="hidden-xs">   
                <img src="symbol_color.png" id='websiteTitleIMG' style="position:relative; float:left;"><span style='float:left'>&nbsp; Skillscape</span>
                <span style="padding-left:10px"><b><i style="font-size:14px;" >Unpacking skills inside jobs and cities</i></b></span>
          </div>
          <div class="hidden-sm hidden-md hidden-lg">    
                <img src="symbol_color.png" id='websiteTitleIMG' style="position:relative; float:left;"><span style='float:left;font-size:18px;padding-left:10px;'><b>Skillscape</b><br>
                <i style="font-size:11px;padding-left:2px;" >Unpacking skills inside jobs and cities</i>
                </span>
          </div>    
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#cssmenu" aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
        </div>
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="cssmenu">
            <ul class="nav navbar-nav">
                <li><a href='index.html'>Home</a></li>
                <!-- <li><a href='jobs_explore.html'>Explore Jobs</a></li> -->
                <li  class='active'><a href='jobs_compare.html'>Compare Jobs</a></li>
                <!-- <li><a href='city_explore.html'>Explore Cities</a></li> -->
                <li><a href='city_compare.html'>Compare Cities</a></li>
                <li ><a href='about.html'>About</a></li>
                <li><a href='methods.html'>Methods</a></li>
            </ul>
        </div>
    </div>
    </nav>
        <div id="graphall" style="position:absolute; width:100%; height:90%;">
            <div class="row">
                <div class="col-sm-3 col-md-3 col-lg-3">
                     <div id="risk_toggle_div" style="float: right;margin-top: 13px">    
                        <span class="toggle-button id="toggle1">
                            <b>&nbsp;&nbsp;Risk of Automation:</b>                    
                            <input id="input_toggle" type="checkbox" data-toggle="toggle" data-size="small">
                        </span>
                    </div>
                </div>
                <div class="col-sm-9 col-md-9 col-lg-9">
                    <div id="legenddiv" class="hidden-xs"></div>
                </div>    
            </div>    
            <div class="row">    
                <div class="col-sm-3 col-md-3 col-lg-3">        
                    <div>
                        <button type="button" id="random1" style="margin-left: 5px;margin-top:5px;margin-bottom:5px"">Show Random Job</button>
                    </div>
                    <div id="search1" class='searchCompare1' action="" name="search" style="position:relative; height:7%">
                    <label for="categories1"><b>&nbsp;&nbsp;Job Category 1: </b></label><br>&nbsp;
                    <select name="categories" id="categories1" style="width:190px;margin-right:10px">
                        <option>Select Category ...</option>
                    </select>
                    </div>
                    <div>
                        <b>&nbsp;&nbsp;Job  Title  1: </b><br>&nbsp;
                        <select name="jobs" id="jobs1" style="width:190px;margin-right:10px">
                            <option>Select Title ...</option>
                        </select>
                    </div>
                    <div>    
                        <b>&nbsp;Search:</b>
                        <br>
                        <input type='text' title='Tags' id='tags2' class='tags' style="width:190px;margin-left:5px;margin-bottom:10px;" />
                    </div>      
                </div>         
                <div id="graph1" class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
                </div>
                <div id="title_description1" class="col-sm-3 col-md-3 col-lg-3">
                    <div id="jobname1" class='jobnameCompare' style="position:relative;top:0%; "></div>
                    <div id="jobdetails1" class='descriptionCompare' style="position:relative;top:0%; "></div>   
                    <div id="description1" class='descriptionCompare' style="position:relative;  top:5%; "></div>    
                </div> 
            </div>
            <!--hr -->            

            <div class="row">
                <div class="col-sm-3 col-md-3 col-lg-3">
                    <div>
                        <button type="button" id="random2" style="margin-left:5px; margin-top:5px;margin-bottom:5px;">Show Random Job</button>
                    </div>
                    
                    <div id="search2" class='searchCompare1' action="" name="search" style="position:relative;height:7%">
                        <label for="categories2"><b>&nbsp;&nbsp;Job Category 2: </b></label><br>&nbsp;
                        <select name="categories2" id="categories2" style="width:190px;">
                            <option>Select Category ...</option>
                        </select>
                    </div>
                    <div>    
                        <b>&nbsp;&nbsp;Job  Title  2: </b><br>&nbsp;
                        <select name="jobs2" id="jobs2" style="width:190px;margin-right:10px">
                            <option>Select Title ...</option>
                        </select>
                    </div>
                    <div>    
                        <b>&nbsp;Search:</b>
                        <br>
                        <input type='text' title='Tags' id='tags3' class='tags' style="width:190px;margin-left:5px;margin-bottom: 10px" />
                    </div>
                </div>         
                <div id="graph2" class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
                </div>
                <div id="title_description2" class="col-sm-3 col-md-3 col-lg-3">
                    <div id="jobname2" class='jobnameCompare' style="position:relative;top:0%;"></div>
                    <div id="jobdetails2" class='descriptionCompare' style="position:relative;top:0%; "></div>   
                    
                    <div id="description2" class='descriptionCompare' style="position:relative;  top:5%;"></div>    
                </div> 
            </div>
        </div>

        <script src="http://d3js.org/d3.v3.min.js"></script>
        <script src="jquery.min.js"></script>
        <script src="http://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
        <script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>
        <script>
        /////////////////////////////////////////////////////////////////
        var scalesize = $(window).width() > 767 ? 1 : 0.3;
        //var tip, legendtip;
        var legendtip = null;


        function definedlegend(svg) {

            if ($(window).width() > 992) {
                drawLegend(svg);
                //createRoundLegend(svg);
            } else {
                if($(window).width()< 768) {
                    drawLegend(svglengend);
                } else {
                    drawLegend(svg);
                }
                //createRoundLegend(svg);
            }

        }

        function createRoundLegend(svg) {
            svgheight = parseInt(svg.style("height"));            
            var g = svg.append("g");
            svg.selectAll("#lengendcircle").remove();

            if ($(window).width() > 767) {
                if ($(window).width() > 992) {
                    if ($(window).width() <1025) {
                        var lengendcircle = g.append("g").attr("id", "lengendcircle").attr("transform", "translate(10,"+(svgheight-80)+") ")
                    } else {
                        var lengendcircle = g.append("g").attr("id", "lengendcircle").attr("transform", "translate(10,"+(svgheight-80)+")")
                    }    
                    var sizetext = '12px'
                } else {
                    var lengendcircle = g.append("g").attr("id", "lengendcircle").attr("transform", "translate(10,"+(svgheight-80)+") ");
                    //translate(" + (150 + width * 9 / 20) + ",8)")
                    var sizetext = '12px'
                }
            } else {
                var lengendcircle = g.append("g").attr("id", "lengendcircle").attr("transform", "translate(10,"+(svgheight-30)+") scale(0.3)");

                //(100 + width * 9 / 20) + ",8)scale(0.3)")
                var sizetext = '12px'
            }
            
            var sizes = [6, 12, 18];
            for (var i in sizes) {
                lengendcircle.append("circle")
                    .attr("r", sizes[i])
                    .attr("cx", 25)
                    .attr("cy", 2 * sizes[sizes.length - 1] - sizes[i] +10)
                    .attr('stroke', 'black')
                    .attr("fill", 'none')
                    .attr("class","legendcircle");
            };        

            lengendcircle.append("text")
                .style("font-size", sizetext)
                .style("color", "black")
                .attr("x", 15)
                .attr("y", 6)
                .text("high")
                .attr("class","legendcircle");

            lengendcircle.append("text")
                .style("font-size", sizetext)
                .style("color", "black")
                .attr("x", 47)
                .attr("y", 30)
                .text("RCA")
                .attr("class","legendcircle");

           lengendcircle.append("text")
                .style("font-size", sizetext)
                .style("color", "black")
                .attr("x", 15)
                .attr("y", 60)
                .text("low")
                .attr("class","legendcircle");
         
         
        }



        ///////////////////////////////////////////////////////////////////////////

        function drawLegend(svg) {

            svg.selectAll("*").remove();
            
            var legenddata = [
                {
                    "Group": "Social",
                    "icon": "social32.png", 
                    "color": "#1477A4"
                },
                {
                    "Group": "Interaction",
                    "icon": "interaction32.png", 
                    "color": "#11D6D3"
                }, 
                {
                    "Group": "Mental",
                    "icon": "mental32.png",
                    "color": "#38a538"
                },
                {
                    "Group": "Managerial",
                    "icon": "manage32.png", 
                    "color": "#BDEC43"
                },
                {
                    "Group": "Basic",
                    "icon": "basic32.png", 
                    "color": "#0DDE91"
                }, 
                {
                    "Group": "Cognitive",
                    "icon": "cognitive32.png",
                    "color": "#993C99"
                },
                {
                    "Group": "Knowledge",
                    "icon": "knowledge32.png",
                    "color": "#FCF91C"
                },
                {
                    "Group": "Technical",
                    "icon": "tech32.png",
                    "color": "#A15000"
                },
                {
                    "Group": "Psychomotor",
                    "icon": "psychomotor32.png",
                    "color": "#FF4C42"
                },   
                {
                    "Group": "Sensory",
                    "icon": "senses32.png", 
                    "color": "#ff00ff"
                }, 
                {
                    "Group": "Info In",
                    "icon": "infoin32.png",
                    "color": "#FFC2FC"
                }, 
                {
                    "Group": "Work Out",
                    "icon": "workout32.png",
                    "color": "#DD7600"
                }, 
                {
                    "Group": "Physical",
                    "icon": "physical32.png",
                    "color": "#FDC337"
                }
            ]

            var legenddata2 = [{
                "Group": "Low Risk",
                "color": 0.37
            }, {
                "Group": "",
                "color": 0.42
            }, {
                "Group": "",
                "color": 0.47
            }, {
                "Group": "Neutral",
                "color": 0.52
            }, {
                "Group": "",
                "color": 0.57
            }, {
                "Group": "",
                "color": 0.62
            }, {
                "Group": "High Risk",
                "color": 0.67
            }]

            
            if (on) {
                            
                var legend = svg.selectAll(".legend")
                    .data(legenddata)
                    .enter()
                        .append("image")
                        .attr("xlink:href", function(d,i) { return "imgs/"+d.icon; })
                        .on('mouseover', legendtip.show)
                        .on('mouseout', legendtip.hide)
                
                var titlelegend1 = svg.selectAll(".legendtitle1")
                    .data(["Job Component"])
                    .enter().append("text")
                    .attr("class", "legendtitle")
                    .style("font-weight", "bold")
                    .text("Socio-Cognitive Categories")
                
                var titlelegend2 = svg.selectAll(".legendtitle2")
                    .data(["Job Component"])
                    .enter().append("text")
                    .attr("class", "legendtitle")
                    .style("font-weight", "bold")
                    .text("Sensory-Physical Categories")
                    
    
                ////////////////////////////////////////////////////////
                if ($(window).width() > 992) {

                    titlelegend1
                        .attr("x", 1)
                        .attr("y", 10);

                    titlelegend2
                        .attr("x", 310)
                        .attr("y", 10);
    
                    if($(window).width() > 1024){ 
                        titlelegend1
                            .attr("x", 31)
                        titlelegend2
                        .attr("x", 460)
                    
                        legend
                            .attr("width", 32)
                            .attr("height", 32)
                            .attr("x", function(d,i) { 
                                if(i<7) {
                                    return i*35;
                                } else {
                                    return i*35+206;
                                }    
                            })     
                    } else {
                        legend
                            .attr("width", 24)
                            .attr("height", 24)
                            .attr("x", function(d,i) { 
                                if(i<7) {
                                    return i*30;
                                } else {
                                    return i*30+110;
                                }    
                            })    
                    }

                    legend                        
                        .attr("y", 15)

                } else {
                    d3.select("#risk_toggle_div")
                        .attr("style","float: left;margin-top: 2px")
                    textSize = '11px';
                    left_offset = 0;
                    if ($(window).width() < 768) {
                        textSize = '10px';
                        left_offset = 30;
                    }   

                    titlelegend1
                        .attr("x", 10)
                        .attr("y", 15)
                        .attr("font-size", textSize);
                    titlelegend2
                        .attr("x", 210-left_offset)
                        .attr("y", 15)
                        .attr("font-size", textSize);

                    legend
                        .attr("x", function(d,i) { 
                            if(i<7) {
                                return i*22+10;
                            } else {
                                return (i*22+60)-left_offset;
                            }    

                        })
                        .attr("y", 25)
                        .attr("width", 16)
                        .attr("height", 16) 
                }
                ///////////////////////////////////////////////////////////////////

            } else {
                var legend = svg.selectAll(".legend")
                    .data(legenddata2)
                    .enter().append("rect")
                    .attr("class", "legend")
                    .attr("fill", function(d) {
                        return color(d.color)
                    })

                var textLegend = svg.selectAll(".legendtext")
                    .data(legenddata2)
                    .enter().append("text")
                    .attr("class", "legendtext")

                .text(function(d) {
                    return d.Group
                })

                var titlelegend1;
                
                ////////////////////////////////////////////////////////
                if ($(window).width() > 992) {
                    legend_size=71;
                    legend_offset=8;
                    
                    if($(window).width() > 1024){
                        legend_size=94;
                        legend_offset=16;
                        
                    }    
                    legend
                        .attr("x", function(d, i) {
                            return legend_size*i;
                        })
                        .attr("y", function(d, i) {
                            return 20;
                        })
                        .attr("width", legend_size)
                        .attr("height", 20)

                    textLegend
                        .attr("x", function(d, i) {
                            return i * legend_size+legend_offset;
                        })
                        .attr("y", 15);
                    
                } else {
                    d3.select("#risk_toggle_div")
                        .attr("style","float: left;margin-top: 2px")
                    if ($(window).width() < 568) {
                        legend_size=46;
                    } else {
                        legend_size=52;
                    }
                    legend
                    .attr("x", function(d, i) {
                            return legend_size*i;
                        })
                        .attr("y", function(d, i) {
                            return 20;
                        })
                        .attr("width", legend_size)
                        .attr("height", 20)

                    textLegend
                        .attr("x", function(d, i) {
                            return i * legend_size;
                        })
                        .attr("y", 15);
                }
            }
        }
        ///////////////////////////////////////////////////////////////////////////////////

        if ($(window).width() > 992) {

            //var startx = 50
            var startx = 0
            var barh = 0
            var barw = 0
            var barfont = 0
        } else {

            var startx = 10
            var barh = 0
            var barw = 0
            var barfont = 0
        }

        var width = $("#graph1").width()
            //var height = $("#graph1").height()   
        var height = ($(window).height() / 2) * 0.8
        var xscale = d3.scale.linear().domain([-10, 21]).range([startx, width])
        var yscale = d3.scale.linear().domain([-1, 25]).range([0, height])

        var tags = '#tags3'
            
        
        var iconobjs = [ 
            {key:'Basic Skills' , icon:'basic24.png'},
            {key:'Social Skills', icon:'social24.png'},
            {key:'Management Skills', icon:'manage24.png'},
            {key:'Cognitive Abilities', icon:'cognitive24.png'},
            {key:'Cognitive Abilititices', icon:'cognitive24.png'},
            {key:'Knowledge', icon:'knowledge24.png'},
            {key:'Mental Processes', icon:'mental24.png'},
            {key:'Interacting With Others', icon:'interaction24.png'},
            {key:'Technical Skills', icon:'tech24.png'},
            {key:'Psychomotor Abilities', icon:'psychomotor24.png'},
            {key:'Sensory Abilities', icon:'senses24.png'},
            {key:'Information Input/Work Output', icon:'infoin24.png'},
            {key:'Work Output', icon:'workout24.png'},
            {key:'Physical Abilities', icon:'physical24.png'},
            {key:'Other', icon:'other24.png'}
        ];



        // create tooltip
        tip = d3.tip()
            .attr('class', 'd3-tip')
            .offset([-10, 0])
            .html(function (d) {
                icon="none";
                for (i = 0; i < iconobjs.length; i++) {
                    if(iconobjs[i].key==d.group){
                        icon=iconobjs[i].icon;
                    }
                }
                risk=d.p_auto.toString();
                styles="padding-bottom:2px;vertical-align:middle;color:"+d.scolor;
                return "<img src='imgs/"+icon+"'><strong  style='color:black'>&nbsp;" + d.group+"</strong'>" 
                        +"<br><pre>&ensp;"+d.name.toUpperCase()+"</pre>"
                        +"<strong style='color:black'>&ensp;RCA : "+d.rca.substring(0, 6) 
                        +"<br>&ensp;Risk of Automation : "+risk.substring(0, 6)
                        +"</strong>";
            });

        var svg1 = d3.select("#graph1").append("svg")
            .attr("width", width)
            .attr("height", height)
            .style("background-color", "#ffffff")
            .style("border-radius","2px")
            .style("border","solid 1px #aaa");
        svg1.call(tip);    
            

        var svg2 = d3.select("#graph2").append("svg")
            .attr("width", width)
            .attr("height", height)
            .style("background-color", "#ffffff")
            .style("border-radius","2px")
            .style("border","solid 1px #aaa");   
        svg2.call(tip);    
                
        // create legend tooltip
        legendtip = d3.tip()
            .attr('class', 'd3-tip')
            .offset([-10, 0])
            .html(function (d) {
                return "<strong  style='color:black'>"+d.Group+"</strong>";
            });
            
        var svglengend = d3.select("#graph2").append("svg")
            .attr("width", width)
            .attr("height", 80)
            .attr('id', 'svglengend');    

        function dragstart(d) {
            d3.select(this).classed("fixed", d.fixed = true);
        }
        ///////////////////////////////////////////////////

        //toggle button code
        colorDomain = [0.37, 0.52, 0.67], //[min,max]
            colorRange = ["#2c25fb", '#eeeeee', "#ff3333"] //["0000ff", "#ffffff", "#ff0000"]

        var color = d3.scale.linear()
            .domain(colorDomain)
            .range(colorRange);

        var on = 1;

        $(document).on('click', '.toggle-button', function() {


            if (on) {
                on = 0;
            } else {
                on = 1;
            }

            $(this).toggleClass('toggle-button-selected');

            d3.json("json files/" + $('#jobs1').val() + ".json", function(error, graph) {
                update(graph, "jobname1", "description1", svg1);
            });

            d3.json("json files/" + $('#jobs2').val() + ".json", function(error, graph) {
                update(graph, "jobname2", "description2", svg2);
            });
        });

        ////////////////////////////////////////////////////////////////////////////////

        function drawnetwork(graph, selector, selector2, selector3, svg) {
            var force = d3.layout.force()
                .linkDistance(1)
                .linkStrength(1)
                .size([width, height]);

            var drag = force.drag()
                .on("dragstart", dragstart);

            //svg.selectAll(".link").remove()
            svg.selectAll(".node").remove()
            //svg.selectAll(".tooltip").remove()

            var div = d3.select("body").append("div")
                .attr("class", "tooltip")
                .style("opacity", 0);

            $(selector2).text(graph.title);
            $(selector3).text(graph.description)
                .attr("text-align", "left");

            addJobDetails(graph, selector2)    


            var nodes = graph.nodes.slice(),
                links = [],
                bilinks = [];

            graph.links.forEach(function(link) {
                var s = nodes[link.source],
                    t = nodes[link.target],
                    i = {}; // intermediate node
                nodes.push(i);
                links.push({
                    source: s,
                    target: i
                }, {
                    source: i,
                    target: t
                });
                bilinks.push([s, i, t]);
            });

            force
                .nodes(nodes)
                .links(links)
                .start();

            var link = svg.selectAll(".link")
                .data(bilinks)
                .enter().append("line")
                .attr("class", "link")
                .attr('x1', function(d) {
                    return xscale(+d[0].cx)
                })
                .attr('x2', function(d) {
                    return xscale(+d[2].cx)
                })
                .attr('y1', function(d) {
                    return yscale(+d[0].cy)
                })
                .attr('y2', function(d) {
                    return yscale(+d[2].cy)
                });

            var node = svg.selectAll(".node")
                .data(graph.nodes)
                .enter().append("circle")
                .attr("class", "node")
                .attr("r", function(d) {
                    return Math.min(30, +d.rca * 5 + 1) * scalesize;
                    //return generateradiussize(+d.rca);
                })
                .attr("cx", function(d) { return xscale(+d.cx)
                })
                .attr("cy", function(d) { return yscale(+d.cy)
                })
                //.attr("fixed", true)
                .style("fill", function(d) {
                    return d.scolor
                })
                .on('mouseover', tip.show)
                .on('mouseout', tip.hide)
                .call(drag);


            if (selector == "#graph2") {
                createRoundLegend(svg);    
            }        


            if (selector == "#graph1") {
                d3.select("#legenddiv")
                    .append("svg")
                    .attr("width", "660")
                    .attr("height", "50")
                    .attr("id","legendsvg");
                var svgleg=d3.select("#legendsvg");
                svgleg.call(legendtip)    
                definedlegend(svgleg);
            }

            //node.exit().remove();

        };

        ////////////////////////////////////////////////////////////////


        function generatedropdown(selector, selector2, selector3, selector4, selector5, selector6, svg) {

            $.fn.changeType = function() {
                var options_categories = '';
                $.each(category_data, function(i, d) {
                    if (i == 0 && selector == "#search1") {
                        options_categories += '<option selected=true value="' + d.code + '">' + d.category + '<\/option>';
                        var d = category_data[0];
                        var options = '';
                        $.each(d.jobs, function(i, j) {
                            options += '<option value="' + j.OCC_Code + '">' + j.title + '<\/option>';
                        });
                        $(selector5).html(options);

                    } else {
                        if (i == 0 && selector == "#search2") {
                            options_categories += '<option value="' + d.code + '">' + d.category + '<\/option>';
                            var d = category_data[0];
                            var options = '';
                            $.each(d.jobs, function(i, j) {
                                if (i == 1) {
                                    options += '<option selected=true value="' + j.OCC_Code + '">' + j.title + '<\/option>';
                                } else {
                                    options += '<option value="' + j.OCC_Code + '">' + j.title + '<\/option>';
                                }
                            });
                            $(selector5).html(options);

                        } else {
                            options_categories += '<option value="' + d.code + '">' + d.category + '<\/option>';
                        }
                    }
                });
                $(selector6, this).html(options_categories);

                $(selector6, this).change(function() {
                    var index = $(this).get(0).selectedIndex;
                    var d = category_data[index];
                    var options = '<option>Select Title ...<\/option>';
                    if (index >= 0) {
                        $.each(d.jobs, function(i, j) {
                            options += '<option value="' + j.OCC_Code + '">' + j.title + '<\/option>';
                        });
                    } else {
                        options += '';
                    }
                    $(selector5).html(options);

                })
            };



            $(selector).changeType();

            $(selector5).change(function(d) {
                d3.json("json files/" + this.value + ".json", function(error, graph) {
                    update(graph, selector3, selector4, svg);

                });
            })


        };

        /////////////////////////////////////////////////////////////////

        // d3.csv("data_generating/bedoor_jobname.csv", function(error, data) {
        generatedropdown('#search1', '#graph1', '#jobname1', '#description1', '#jobs1', '#categories1', svg1);
        generatedropdown('#search2', '#graph2', '#jobname2', '#description2', '#jobs2', '#categories2', svg2);
        //});


        d3.json("json files/11-1011.json", function(error, graph) {
            drawnetwork(graph, '#graph1', '#jobname1', '#description1', svg1);
        })

        d3.json("json files/11-1021.json", function(error, graph) {
            drawnetwork(graph, '#graph2', '#jobname2', '#description2', svg2);
        })

        /////////////////////////////////////////////////////////////////
        function generateradiussize(rca) {
           
            if (rca <= 0.2589988343) {
                return 1;
            } else if (rca <= 0.5485674132) {
                return 2.5;
            } else if (rca <= 0.7081012255) {
                return 4;
            } else if (rca <= 0.8236051749) {
                return 5.5;
            } else if (rca <= 0.9320670719) {
                return 7;
            } else if (rca <= 1.0425610511) {
                return 8.5;
            } else if (rca <= 1.1751796521) {
                return 10;
            } else if (rca <= 1.3608859543) {
                return 11.5;
            } else if (rca <= 1.7132505599) {
                return 13;
            } else if (rca <= 19.6583007245) {
                return 14.5;
            }
        };

        ////////////////////////////////////////////////////////////////////////
        function update(graph, selector, selector2, svg) {

            $(selector).text(graph.title);
            $(selector2).text(graph.description)
                .attr("text-align", "left");
            
            addJobDetails(graph, selector);
            
                
            // read new data
            var nodearray = graph.nodes;
            var tempObject = {};
            for (var i = 0; i < nodearray.length; ++i) {
                tempObject[nodearray[i]['name']] = +nodearray[i]['rca'];
            }

            // update node size
            var nodeupdate = svg.selectAll(".node");
            nodeupdate
                .transition()
                .duration(750)
                .attr("r", function(d) {
                    d.rca=tempObject[d.name].toString();
                    return Math.min(30, tempObject[d.name] * 5 + 1) * scalesize;                    
                    //return generateradiussize(tempObject[d.name]);

                });


            //change if auto toggle selected
            if (!on) {
                nodeupdate
                    .style("fill", function(d) {
                        if (d.p_auto == -1) {
                            return "#aaaaaa"
                        } else {
                            return color(d.p_auto);
                        }
                    })
//                definedlegend(svg2);

            } else {
                nodeupdate
                    .style("fill", function(d) {
                        return d.scolor;
                    })
//                definedlegend(svg2);
            }
            var svgleg=d3.select("#legendsvg");    
            definedlegend(svgleg);

        }




        /////////// for search box/////////////////

            var jobList = {}
            for (j = 0; j < category_data.length; j++) {
                var item = category_data[j]
                for (k = 0; k < item.jobs.length; k++) {
                    jobList[item.jobs[k].title] = item.jobs[k].OCC_Code
                }
            }
            //var dataArray = Object.keys(jobList).map(function(k){return jobList[k]});

            $('#tags2').autocomplete({
                source: Object.keys(jobList),
                select: function( event, ui ) {
                    selectedJob = ui.item.label;
                    if ($.inArray(selectedJob, Object.keys(jobList)) > -1) {
                        d3.json("json files/" + jobList[selectedJob] + ".json", function (error, graph) {
                            update(graph, '#jobname1', '#description1', svg1);
                        });
                    }

                }
            })

            $('#tags3').autocomplete({
                source: Object.keys(jobList),
                select: function( event, ui ) {
                    selectedJob = ui.item.label;
                    if ($.inArray(selectedJob, Object.keys(jobList)) > -1) {
                        d3.json("json files/" + jobList[selectedJob] + ".json", function (error, graph) {
                        update(graph, "#jobname2", "#description2", svg2);    
                        });
                    }
                }
            })


        ////////////////////// add random////////////////////////
        document.getElementById('random1').onclick = function() {

            var randomCategorieIndex = Math.floor(Math.random() * category_data.length)
            var randomCategorie = category_data[randomCategorieIndex]
            var randomjobIndex = Math.floor(Math.random() * randomCategorie.jobs.length)
            var randomjob = randomCategorie.jobs[randomjobIndex]

            // update catefories dropdown

            $('#categories1').val(randomCategorie.code)
                // update jobs drop down
            var options = '';
            $.each(randomCategorie.jobs, function(i, j) {
                options += '<option value="' + j.OCC_Code + '">' + j.title + '<\/option>';
            });

            $('#jobs1').html(options);
            $('#jobs1').val(randomjob.OCC_Code);



            d3.json("json files/" + randomjob.OCC_Code + ".json", function(error, graph) {
                update(graph, '#jobname1', '#description1', svg1);
            });
        };

        document.getElementById('random2').onclick = function() {

            var randomCategorieIndex = Math.floor(Math.random() * category_data.length)
            var randomCategorie = category_data[randomCategorieIndex]
            var randomjobIndex = Math.floor(Math.random() * randomCategorie.jobs.length)
            var randomjob = randomCategorie.jobs[randomjobIndex]

          
            // update catefories dropdown

            $('#categories2').val(randomCategorie.code)
                // update jobs drop down
            var options = '';
            $.each(randomCategorie.jobs, function(i, j) {
                options += '<option value="' + j.OCC_Code + '">' + j.title + '<\/option>';
            });

            $('#jobs2').html(options);

            $('#jobs2').val(randomjob.OCC_Code);

            d3.json("json files/" + randomjob.OCC_Code + ".json", function(error, graph) {
                update(graph, '#jobname2', '#description2', svg2);
            });
        };
        /////////////////////////////////////////////////////////////
        function addJobDetails(graph, selector){
            textDetails="";
            if(typeof graph.employees !='undefined') {
                textDetails=textDetails+"TOTAL EMPLOYEES:"+graph.employees+"<br>";
            }    
            if(typeof graph.wage !='undefined') {
                textDetails=textDetails+"WAGE:"+graph.wage+"<br>";
            }    
            if(typeof graph.automation !='undefined') {
                textDetails=textDetails+"RISK OF AUTOMATION:"+graph.automation+"<br>";
            }    
            if(typeof graph.cognitive !='undefined') {
                textDetails=textDetails+"COGNITIVE FRACTION:"+graph.cognitive+"<br>";
            }    
            if(selector=="#jobname1") { 
                detailsSelector="#jobdetails1";
            } else {
                detailsSelector="#jobdetails2";
            }

            $(detailsSelector)
                .html(textDetails);    
            
        }
        </script>
</body>

</HTML>
